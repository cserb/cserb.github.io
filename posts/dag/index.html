<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8" />
	<meta http-equiv="X-UA-Compatible" content="IE=edge"><title>Build your first blockchain from scratch (#2 DAG)  - cșerb</title><meta name="viewport" content="width=device-width, initial-scale=1">
	<meta property="og:title" content="Build your first blockchain from scratch (#2 DAG) " />
<meta property="og:description" content="How to use a DAG to find the longest chain" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://cserb.net/posts/dag/" />
<meta property="article:published_time" content="2019-10-31T13:10:12+01:00" />
<meta property="article:modified_time" content="2019-10-31T13:10:12+01:00" />
<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Build your first blockchain from scratch (#2 DAG) "/>
<meta name="twitter:description" content="How to use a DAG to find the longest chain"/>
<link href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,300italic,400italic|Raleway:200,300" rel="stylesheet">

	<link rel="stylesheet" type="text/css" media="screen" href="https://cserb.net/css/normalize.css" />
	<link rel="stylesheet" type="text/css" media="screen" href="https://cserb.net/css/main.css" />
	<link rel="stylesheet" type="text/css" href="https://cserb.net/css/custom.css" />
	

	<script src="https://cdn.jsdelivr.net/npm/feather-icons/dist/feather.min.js"></script>
	<script src="https://cserb.net/js/main.js"></script>
</head>

<body>
	<div class="container wrapper post">
		<div class="header">
	<h1 class="site-title"><a href="/">cșerb</a></h1>
	<div class="site-description"><h2>cserb.net — blockchain, crystal, startups</h2><nav class="nav social">
			<ul class="flat"><a href="https://github.com/cserb" title="Github"><i data-feather="github"></i></a><a href="https://twitter.com/cerbivore" title="Twitter"><i data-feather="twitter"></i></a></ul>
		</nav>
	</div>

	<nav class="nav">
		<ul class="flat">
			
			<li>
				<a href="/">Home</a>
			</li>
			
			<li>
				<a href="/posts">Posts</a>
			</li>
			
			<li>
				<a href="https://represent.io/cserb">CV</a>
			</li>
			
		</ul>
	</nav>
</div>


		<div class="post-header">
			<h1 class="title">Build your first blockchain from scratch (#2 DAG) </h1>
			<div class="meta">Posted at &mdash; Oct 31, 2019</div>
		</div>

		<div class="markdown">
			

<h2 id="how-to-use-a-dag-to-find-the-longest-chain">How to use a DAG to find the longest chain</h2>

<p><strong>1. Introduction</strong></p>

<p>In the <a href="https://dev.to/cerbivore/build-your-first-blockchain-from-scratch-463p">first part #1</a> we talked about how probabilistic finality works and why it&rsquo;s needed. Also we saw an example of how blocks might be structured and linked to each other:</p>

<p><img src="https://thepracticaldev.s3.amazonaws.com/i/bfimp8gtxgbiyc5pb480.png" alt="Alt Text" /></p>

<p>The data structure above resembles a Directed Acyclic Graph (DAG) and fortunately DAGs allow for an easy way to find the longest chain. This is an important part of achieving probabilistic finality.</p>

<p>A DAG is made up of nodes (also called vertices) and edges. An edge represents a link between 2 vertices (e.g. <code>3000.1-&gt;3001.1</code>). We can and should traverse a DAG to find out more about its structure, like how far away is vertex <code>3005.1</code> from vertex <code>3000.1</code></p>

<p>Additionally a DAG has some unique properties. Find out more about it <a href="https://www.youtube.com/watch?v=TXkDpqjDMHA">here</a></p>

<p><strong>2. How to find the longest chain</strong></p>

<p>If we look again at the example above, it becomes apparent that <code>3005.1</code> is the tip of the longest chain. But how can we find it out programmatically?</p>

<p>We are going to use <a href="https://www.youtube.com/watch?v=7fujbpJ0LB4">Depth First Search</a> to traverse the graph and mark every vertex with its distance from the starting vertex.
We start at <code>3000.1</code> and give it a distance of <code>0</code>. Now we traverse through all vertices and give each a distance of <code>parent distance + 1</code>. So <code>3001.1</code> has a <code>parent distance</code> of <code>0</code> and <code>+1</code> gives a distance of <code>1</code>.</p>

<p><img src="https://thepracticaldev.s3.amazonaws.com/i/qexgjvm9yv8ko8cwv6y2.png" alt="Alt Text" /></p>

<p><strong>3. Conclusion</strong></p>

<p>If we store blocks as a DAG, we can use Depth First Search to find the longest chain.</p>

<p><strong>4. Next Up</strong></p>

<p>We will finally make our hands dirty and implement a DAG in <a href="https://crystal-lang.org">Crystal</a></p>

<p>UPDATE: <a href="https://dev.to/cerbivore/building-your-first-blockchain-from-scratch-3-finding-the-longest-branch-glp">#3 Finding the longest chain</a> implementation</p>

		</div>

		<div class="post-tags">
			
				
			
		</div></div>
	<div class="footer wrapper">
	<nav class="nav">
		<div> © 2019 Cristian Serb |  <a href="https://github.com/vividvilla/ezhil">Ezhil theme</a> | Built with <a href="https://gohugo.io">Hugo</a></div>
	</nav>
</div>

<script>feather.replace()</script>
</body>
</html>
